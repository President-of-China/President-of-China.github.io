(self.webpackChunk_lls_web_app=self.webpackChunk_lls_web_app||[]).push([[613],{84158:(k,E,d)=>{var T=d(98022),g=d(43335),m=d(22699).EventEmitter,u=d(54378),s=d(99356),l=d(63872);function n(e,t){var i=this;if(t=t||{},typeof e=="object"&&(t=e||{}),typeof e=="function"&&(t.process=e),!t.process)throw new Error("Queue has no process function.");if(t=t||{},i.process=t.process||function(r,f){f(null,{})},i.filter=t.filter||function(r,f){f(null,r)},i.merge=t.merge||function(r,f,c){c(null,f)},i.precondition=t.precondition||function(r){r(null,!0)},i.setImmediate=t.setImmediate||setImmediate,i.id=t.id||"id",i.priority=t.priority||null,i.cancelIfRunning=t.cancelIfRunning===void 0?!1:!!t.cancelIfRunning,i.autoResume=t.autoResume===void 0?!0:!!t.autoResume,i.failTaskOnProcessException=t.failTaskOnProcessException===void 0?!0:!!t.failTaskOnProcessException,i.filo=t.filo||!1,i.batchSize=t.batchSize||1,i.batchDelay=t.batchDelay||0,i.batchDelayTimeout=t.batchDelayTimeout||1/0,i.afterProcessDelay=t.afterProcessDelay||0,i.concurrent=t.concurrent||1,i.maxTimeout=t.maxTimeout||1/0,i.maxRetries=t.maxRetries||0,i.retryDelay=t.retryDelay||0,i.storeMaxRetries=t.storeMaxRetries||1/0,i.storeRetryTimeout=t.storeRetryTimeout||1e3,i.preconditionRetryTimeout=t.preconditionRetryTimeout||1e3,i._queuedPeak=0,i._queuedTime={},i._processedTotalElapsed=0,i._processedAverage=0,i._processedTotal=0,i._failedTotal=0,i.length=0,i._stopped=!1,i._saturated=!1,i._preconditionRetryTimeoutId=null,i._batchTimeoutId=null,i._batchDelayTimeoutId=null,i._connected=!1,i._storeRetries=0,i._hasMore=!1,i._isWriting=!1,i._writeQueue=[],i._writing={},i._tasksWaitingForConnect=[],i._calledDrain=!0,i._calledEmpty=!0,i._fetching=0,i._running=0,i._retries={},i._workers={},i._tickets={},i.use(t.store||"memory"),!i._store)throw new Error("Queue cannot continue without a valid store.")}g.inherits(n,m),n.prototype.destroy=function(e){e=e||function(){};var t=this;t._hasMore=!1,t._isWriting=!1,t._writeQueue=[],t._writing={},t._tasksWaitingForConnect=[],t._tickets={},t._workers={},t._fetching=0,t._running={},t._retries={},t._calledEmpty=!0,t._calledDrain=!0,t._connected=!1,t.pause(),typeof t._store.close=="function"?t._store.close(e):e()},n.prototype.resetStats=function(){this._queuedPeak=0,this._processedTotalElapsed=0,this._processedAverage=0,this._processedTotal=0,this._failedTotal=0},n.prototype.getStats=function(){var e=this._processedTotal===0?0:1-this._failedTotal/this._processedTotal;return{successRate:e,peak:this._queuedPeak,average:this._processedAverage,total:this._processedTotal}},n.prototype.use=function(e,t){var i=this,r=function(c){var p;try{p=d(32739)("better-queue-"+c)}catch(h){throw new Error("Attempting to require better-queue-"+c+`, but failed.
Please ensure you have this store installed via npm install --save better-queue-`+c)}return p};if(typeof e=="string"){var f=r(e);i._store=new f(t)}else if(typeof e=="object"&&typeof e.type=="string"){var f=r(e.type);i._store=new f(e)}else if(typeof e=="object"&&e.putTask&&e.getTask&&(i.filo&&e.takeLastN||!i.filo&&e.takeFirstN))i._store=e;else throw new Error("unknown_store");i._connected=!1,i._tasksWaitingForConnect=[],i._connectToStore()},n.prototype._connectToStore=function(){var e=this;if(!e._connected){if(e._storeRetries>=e.storeMaxRetries)return e.emit("error",new Error("failed_connect_to_store"));e._storeRetries++,e._store.connect(function(t,i){if(t)return setTimeout(function(){e._connectToStore()},e.storeRetryTimeout);if(i==null)throw new Error("store_not_returning_length");if(e.length=parseInt(i),isNaN(e.length))throw new Error("length_is_not_a_number");e.length&&(e._calledDrain=!1),e._connected=!0,e._storeRetries=0,e._store.getRunningTasks(function(r,f){!e._stopped&&e.autoResume&&(Object.keys(f).forEach(function(p){e._running++,e._startBatch(f[p],{},p)}),e.resume());for(var c=0;c<e._tasksWaitingForConnect.length;c++)e.push(e._tasksWaitingForConnect[c].input,e._tasksWaitingForConnect[c].ticket)})})}},n.prototype.resume=function(){var e=this;e._stopped=!1,e._getWorkers().forEach(function(t){typeof t.resume=="function"&&t.resume()}),setTimeout(function(){e._processNextAfterTimeout()},0)},n.prototype.pause=function(){this._stopped=!0,this._getWorkers().forEach(function(e){typeof e.pause=="function"&&e.pause()})},n.prototype.cancel=function(e,t){t=t||function(){};var i=this,r=i._workers[e];r&&r.cancel(),i._store.deleteTask(e,t)},n.prototype.push=function(e,t){var i=this,r=new u;return t instanceof u?r=t:t&&r.on("finish",function(f){t(null,f)}).on("failed",function(f){t(f)}),i._connected?(i.filter(e,function(f,c){if(f||c===void 0||c===!1||c===null)return r.failed("input_rejected");var p=function(h){setTimeout(function(){i._queueTask(h,c,r)},0)};typeof i.id=="function"?i.id(c,function(h,a){if(h)return r.failed("id_error");p(a)}):typeof i.id=="string"&&typeof c=="object"?p(c[i.id]):p()}),r):(i._tasksWaitingForConnect.push({input:e,ticket:r}),r)},n.prototype._getWorkers=function(){var e=this,t=[];return Object.keys(e._workers).forEach(function(i){var r=e._workers[i];r&&t.indexOf(r)===-1&&t.push(r)}),t},n.prototype._writeNextTask=function(){var e=this;if(!e._isWriting&&!!e._writeQueue.length){e._isWriting=!0;var t=e._writeQueue.shift(),i=function(){e._isWriting=!1,e.setImmediate(function(){e._writeNextTask()})};if(!e._writing[t])return delete e._writing[t],i();var r=e._writing[t].task,f=e._writing[t].priority,c=e._writing[t].isNew,p=e._writing[t].id,h=e._writing[t].tickets;e._store.putTask(t,r,f,function(a){if(e._writing[t]&&e._writing[t].id!==p)return e._writeQueue.unshift(t),i();if(delete e._writing[t],a)return h.failed("failed_to_put_task"),i();c&&(e.length++,e._queuedPeak<e.length&&(e._queuedPeak=e.length),e._queuedTime[t]=new Date().getTime()),e._tickets[t]?e._tickets[t].push(h):e._tickets[t]=h,e.emit("task_queued",t,r),h.queued(),c&&(e._calledDrain=!1,e._calledEmpty=!1),e._fetching>0&&(e._hasMore=!0),e.batchDelayTimeout<1/0&&(e._batchDelayTimeoutId&&clearTimeout(e._batchDelayTimeoutId),e._batchDelayTimeoutId=setTimeout(function(){e._batchDelayTimeoutId=null,e._batchTimeoutId&&clearTimeout(e._batchTimeoutId),e._batchTimeoutId=null,e._processNextIfAllowed()},e.batchDelayTimeout)),i(),e._processNextAfterTimeout()})}},n.prototype._queueTask=function(e,t,i){var r=this,f=new u;i=i||f;var c=!1;e||(e=T.v4(),c=!0);var p,h=null,a=!0,_=function(){if(!!r._connected){var v=r._writing[e]&&r._writing[e].tickets||new l;i!==f&&v.push(i);var y=!!r._writing[e];r._writing[e]={id:T.v4(),isNew:a,task:t,priority:p,tickets:v},y||r._writeQueue.push(e),r._writeNextTask()}},o=function(){if(i.accept(),r.emit("task_accepted",e,t),!r.priority)return _();r.priority(t,function(v,y){if(v)return i.failed("failed_to_prioritize");p=y,_()})},w=function(){if(!h)return o();r.merge(h,t,function(v,y){if(v)return i.failed("failed_task_merge");y!==void 0&&(t=y,o())})};if(c)return o();var x=r._workers[e];if(r.cancelIfRunning&&x&&x.cancel(),r._writing[e])return h=r._writing[e].task,w();r._store.getTask(e,function(v,y){if(v)return i.failed("failed_to_get");if(y!==void 0&&(a=!1),r._writing[e])return h=r._writing[e].task,w();if(y===void 0)return o();h=y,w()})},n.prototype._emptied=function(){this._calledEmpty||(this._calledEmpty=!0,this.emit("empty"))},n.prototype._drained=function(){this._calledDrain||(this._calledDrain=!0,this.emit("drain"))},n.prototype._getNextBatch=function(e){this._store[this.filo?"takeLastN":"takeFirstN"](this.batchSize,e)},n.prototype._processNextAfterTimeout=function(){var e=this;e.length>=e.batchSize?(e._batchTimeoutId&&(clearTimeout(e._batchTimeoutId),e._batchTimeoutId=null),e.setImmediate(function(){e._processNextIfAllowed()})):!e._batchTimeoutId&&e.batchDelay<1/0&&(e._batchTimeoutId=setTimeout(function(){e._batchTimeoutId=null,e._processNextIfAllowed()},e.batchDelay))},n.prototype._processNextIfAllowed=function(){var e=this;if(!!e._connected&&!e._stopped&&(e._saturated=e._running+e._fetching>=e.concurrent,!e._saturated)){if(!e.length){e._hasMore||(e._emptied(),e._running||e._drained());return}e.precondition(function(t,i){t||!i?!e._preconditionRetryTimeoutId&&e.preconditionRetryTimeout&&(e._preconditionRetryTimeoutId=setTimeout(function(){e._preconditionRetryTimeoutId=null,e._processNextIfAllowed()},e.preconditionRetryTimeout)):e._processNext()})}},n.prototype._processNext=function(){var e=this;e._hasMore=!1,e._fetching++,e._getNextBatch(function(t,i){e._fetching--,!(t||i===void 0)&&e._store.getLock(i,function(r,f){if(!(r||!f)){var c=Object.keys(f).length,p=c===0;if(e.length<c&&(e.length=c),!e._hasMore&&p){e._emptied(),e._running||e._drained();return}if(e._hasMore&&p)return e._processNextAfterTimeout();var h={};Object.keys(f).forEach(function(a){var _=e._tickets[a];_&&(_.started(),h[a]=_,delete e._tickets[a])}),e._running++,e._startBatch(f,h,i),e.concurrent-e._running>1&&e._processNextIfAllowed()}})})},n.prototype._startBatch=function(e,t,i){var r=this,f=Object.keys(e),c=null,p=new s({fn:r.process,batch:e,single:r.batchSize===1,failTaskOnProcessException:r.failTaskOnProcessException}),h=function(a){r._processedTotal++;var _={};if(!r._queuedTime[a])return _;var o=new Date().getTime()-r._queuedTime[a];return delete r._queuedTime[a],o>0&&(_.elapsed=o,r._processedTotalElapsed+=o,r._processedAverage=r._processedTotalElapsed/r._processedTotal),_};r.maxTimeout<1/0&&(c=setTimeout(function(){p.failedBatch("task_timeout")},r.maxTimeout)),p.on("task_failed",function(a,_){var o=f[a];if(r._retries[o]=r._retries[o]||0,r._retries[o]++,p.cancelled||r._retries[o]>=r.maxRetries){var w=h(o);t[o]&&(t[o].failed(_),delete t[o]),r._failedTotal++,r.emit("task_failed",o,_,w)}else r.retryDelay?setTimeout(function(){r.emit("task_retry",o,r._retries[o]),r._queueTask(o,e[o],t[o])},r.retryDelay):r.setImmediate(function(){r.emit("task_retry",o,r._retries[o]),r._queueTask(o,e[o],t[o])})}),p.on("task_finish",function(a,_){var o=f[a],w=h(o);t[o]&&(t[o].finish(_),delete t[o]),r.emit("task_finish",o,_,w)}),p.on("task_progress",function(a,_){var o=f[a];t[o]&&(t[o].progress(_),delete t[o]),r.emit("task_progress",o,_)}),p.on("progress",function(a){r.emit("batch_progress",a)}),p.on("finish",function(a){r.emit("batch_finish",a)}),p.on("failed",function(a){r.emit("batch_failed",a)}),p.on("end",function(){r.length-=Object.keys(e).length,c&&clearTimeout(c);var a=function(){!r._connected||r._store.releaseLock(i,function(_){if(_)return setTimeout(function(){a()},1);r._running--,f.forEach(function(o){r._workers[o]&&!r._workers[o].active&&delete r._workers[o]}),r._processNextAfterTimeout()})};r.afterProcessDelay?setTimeout(function(){a()},r.afterProcessDelay):r.setImmediate(function(){a()})}),f.forEach(function(a){r._workers[a]=p});try{p.start(),f.forEach(function(a){r.emit("task_started",a,e[a])})}catch(a){r.emit("error",a)}},k.exports=n},54378:(k,E,d)=>{var T=d(43335),g=d(22699).EventEmitter,m=d(36182);function u(s){this.isAccepted=!1,this.isQueued=!1,this.isStarted=!1,this.isFailed=!1,this.isFinished=!1,this.result=null,this.status="created",this.eta=new m}T.inherits(u,g),u.prototype.accept=function(){this.status="accepted",this.isAccepted=!0,this.emit("accepted")},u.prototype.queued=function(){this.status="queued",this.isQueued=!0,this.emit("queued")},u.prototype.unqueued=function(){this.status="accepted",this.isQueued=!1,this.emit("unqueued")},u.prototype.started=function(){this.eta.count=1,this.eta.start(),this.isStarted=!0,this.status="in-progress",this.emit("started")},u.prototype.failed=function(s){this.isFailed=!0,this.isFinished=!0,this.status="failed",this.emit("failed",s)},u.prototype.finish=function(s){this.eta.done=this.eta.count,this.isFinished=!0,this.status="finished",this.result=s,this.emit("finish",this.result)},u.prototype.stopped=function(){this.eta=new m,this.isFinished=!1,this.isStarted=!1,this.status="queued",this.result=null,this.emit("stopped")},u.prototype.progress=function(s){this.eta.done=s.complete,this.eta.count=s.total,this.emit("progress",{complete:this.eta.done,total:this.eta.count,pct:this.eta.done/this.eta.count*100,eta:this.eta.format("{{etah}}"),message:s.message})},k.exports=u},63872:(k,E,d)=>{var T=d(54378);function g(){this.tickets=[]}g.prototype._apply=function(m,u){this.tickets.forEach(function(s){s[m].apply(s,u)})},g.prototype.push=function(m){var u=this;if(m instanceof g)return m.tickets.forEach(function(s){u.push(s)});m instanceof T&&u.tickets.indexOf(m)===-1&&u.tickets.push(m)},Object.keys(T.prototype).forEach(function(m){g.prototype[m]=function(){this._apply(m,arguments)}}),k.exports=g},99356:(k,E,d)=>{var T=d(43335),g=d(22699).EventEmitter,m=d(36182);function u(s){this.fn=s.fn,this.batch=s.batch,this.single=s.single,this.active=!1,this.cancelled=!1,this.failTaskOnProcessException=s.failTaskOnProcessException}T.inherits(u,g),u.prototype.setup=function(){var s=this;s._taskIds=Object.keys(s.batch),s._process={},s._waiting={},s._eta=new m,s.counts={finished:0,failed:0,completed:0,total:s._taskIds.length},s.status="ready",s.progress={tasks:{},complete:0,total:s._taskIds.length,eta:""},s._taskIds.forEach(function(l,n){s._waiting[n]=!0,s.progress.tasks[n]={pct:0,complete:0,total:1}})},u.prototype.start=function(){var s=this;if(!s.active){s.setup(),s._eta.count=s.progress.total,s._eta.start(),s.active=!0,s.status="in-progress";var l=s._taskIds.map(function(n){return s.batch[n]});s.single&&(l=l[0]);try{s._process=s.fn.call(s,l,function(n,e){!s.active||(n?s.failedBatch(n):s.finishBatch(e))})}catch(n){if(s.failTaskOnProcessException)s.failedBatch(n);else throw new Error(n)}s._process=s._process||{}}},u.prototype.end=function(){!this.active||(this.status="finished",this.active=!1,this.emit("end"))},u.prototype.resume=function(){typeof this._process.resume=="function"&&this._process.resume(),this.status="in-progress"},u.prototype.pause=function(){typeof this._process.pause=="function"&&this._process.pause(),this.status="paused"},u.prototype.cancel=function(){this.cancelled=!0,typeof this._process.cancel=="function"&&this._process.cancel(),typeof this._process.abort=="function"&&this._process.abort(),this.failedBatch("cancelled")},u.prototype.failedBatch=function(s){var l=this;!l.active||(Object.keys(l._waiting).forEach(function(n){!l._waiting[n]||l.failedTask(n,s)}),l.emit("failed",s),l.end())},u.prototype.failedTask=function(s,l){var n=this;!n.active||n._waiting[s]&&(n._waiting[s]=!1,n.counts.failed++,n.counts.completed++,n.emit("task_failed",s,l))},u.prototype.finishBatch=function(s){var l=this;!l.active||(Object.keys(l._waiting).forEach(function(n){!l._waiting[n]||l.finishTask(n,s)}),l.emit("finish",s),l.end())},u.prototype.finishTask=function(s,l){var n=this;!n.active||n._waiting[s]&&(n._waiting[s]=!1,n.counts.finished++,n.counts.completed++,n.emit("task_finish",s,l))},u.prototype.progressBatch=function(s,l,n){var e=this;!e.active||(Object.keys(e._waiting).forEach(function(t){!e._waiting[t]||e.progressTask(t,s,l,n)}),e.progress.complete=0,e._taskIds.forEach(function(t,i){e.progress.complete+=e.progress.tasks[i].pct}),e._eta.done=e.progress.complete,e.progress.eta=e._eta.format("{{etah}}"),e.progress.message=n||"",e.emit("progress",e.progress))},u.prototype.progressTask=function(s,l,n,e){var t=this;!t.active||t._waiting[s]&&(t.progress.tasks[s].complete=l,t.progress.tasks[s].total=t.progress.tasks[s].total||n,t.progress.tasks[s].message=t.progress.tasks[s].message||e,t.progress.tasks[s].pct=Math.max(0,Math.min(1,l/n)),t.emit("task_progress",s,t.progress.tasks[s]))},k.exports=u}}]);
